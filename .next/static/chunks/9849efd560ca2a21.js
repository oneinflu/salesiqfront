(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,37142,e=>{"use strict";var t=e.i(43476),s=e.i(71645),i=e.i(53169),l=e.i(51542),r=e.i(21579),a=e.i(30774);let n=({size:e=24,color:t="currentColor",...i})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...i},s.createElement("path",{d:"M18 6 6 18M6 6l12 12"}));n.displayName="XClose";let o=({size:e=24,color:t="currentColor",...i})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...i},s.createElement("path",{d:"m18 10-4-4M2.5 21.5l3.384-.376c.414-.046.62-.069.814-.131a2 2 0 0 0 .485-.234c.17-.111.317-.259.61-.553L21 7a2.828 2.828 0 1 0-4-4L3.794 16.206c-.294.294-.442.442-.553.611a2 2 0 0 0-.234.485c-.062.193-.085.4-.131.814L2.5 21.5Z"}));o.displayName="Edit02";var c=e.i(34874),d=e.i(42366),u=e.i(70878);let x=({size:e=24,color:t="currentColor",...i})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...i},s.createElement("path",{d:"m18 15-6-6-6 6"}));x.displayName="ChevronUp";var m=e.i(99938),g=e.i(9348),p=e.i(38891);let f=({size:e=24,color:t="currentColor",...i})=>s.createElement("svg",{viewBox:"0 0 24 24",width:e,height:e,stroke:t,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...i},s.createElement("path",{d:"m7.5 12 3 3 6-6m5.5 3c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Z"}));f.displayName="CheckCircle";var h=e.i(22384),y=e.i(47209),b=e.i(57793),v=e.i(10031),j=e.i(24099),N=e.i(72228),C=e.i(53798),w=e.i(46859),k=e.i(29427),K=e.i(50179);e.i(47167);let S=new WeakMap;function I(e,t,s){if(!e)return"";"string"==typeof t&&(t=t.replace(/\s+/g,""));let i=S.get(e);return`${i}-${s}-${t}`}class P{getKeyLeftOf(e){return this.flipDirection?this.getNextKey(e):this.getPreviousKey(e)}getKeyRightOf(e){return this.flipDirection?this.getPreviousKey(e):this.getNextKey(e)}isDisabled(e){var t,s;return this.disabledKeys.has(e)||!!(null==(s=this.collection.getItem(e))||null==(t=s.props)?void 0:t.isDisabled)}getFirstKey(){let e=this.collection.getFirstKey();return null!=e&&this.isDisabled(e)&&(e=this.getNextKey(e)),e}getLastKey(){let e=this.collection.getLastKey();return null!=e&&this.isDisabled(e)&&(e=this.getPreviousKey(e)),e}getKeyAbove(e){return this.tabDirection?null:this.getPreviousKey(e)}getKeyBelow(e){return this.tabDirection?null:this.getNextKey(e)}getNextKey(e){let t=e;do null==(t=this.collection.getKeyAfter(t))&&(t=this.collection.getFirstKey());while(null!=t&&this.isDisabled(t))return t}getPreviousKey(e){let t=e;do null==(t=this.collection.getKeyBefore(t))&&(t=this.collection.getLastKey());while(null!=t&&this.isDisabled(t))return t}constructor(e,t,s,i=new Set){this.collection=e,this.flipDirection="rtl"===t&&"horizontal"===s,this.disabledKeys=i,this.tabDirection="horizontal"===s}}var M=e.i(20246),E=e.i(60433),L=e.i(96102),D=e.i(87026),z=e.i(69080),A=e.i(11458),R=e.i(49962),F=e.i(84656),_=e.i(71330),B=e.i(1071),T=e.i(36629),O=e.i(82528),V=e.i(38299),H=e.i(97547);e.i(99661);var U=e.i(36836),W=e.i(62633);class ${*[Symbol.iterator](){yield*this.iterable}get size(){return this._size}getKeys(){return this.keyMap.keys()}getKeyBefore(e){var t;let s=this.keyMap.get(e);return s&&null!=(t=s.prevKey)?t:null}getKeyAfter(e){var t;let s=this.keyMap.get(e);return s&&null!=(t=s.nextKey)?t:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(e){var t;return null!=(t=this.keyMap.get(e))?t:null}at(e){let t=[...this.getKeys()];return this.getItem(t[e])}getChildren(e){let t=this.keyMap.get(e);return(null==t?void 0:t.childNodes)||[]}constructor(e){var t;this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=e;let s=e=>{if(this.keyMap.set(e.key,e),e.childNodes&&"section"===e.type)for(let t of e.childNodes)s(t)};for(let t of e)s(t);let i=null,l=0,r=0;for(let[e,t]of this.keyMap)i?(i.nextKey=e,t.prevKey=i.key):(this.firstKey=e,t.prevKey=void 0),"item"===t.type&&(t.index=l++),("section"===t.type||"item"===t.type)&&r++,(i=t).nextKey=void 0;this._size=r,this.lastKey=null!=(t=null==i?void 0:i.key)?t:null}}var G=e.i(69255),Q=e.i(35081),Y=e.i(65240),Z=e.i(35190);function q(e,t){let s=null;if(e){var i,l,r,a;for(s=e.getFirstKey();null!=s&&(t.has(s)||(null==(l=e.getItem(s))||null==(i=l.props)?void 0:i.isDisabled))&&s!==e.getLastKey();)s=e.getKeyAfter(s);null!=s&&(t.has(s)||(null==(a=e.getItem(s))||null==(r=a.props)?void 0:r.isDisabled))&&s===e.getLastKey()&&(s=e.getFirstKey())}return s}let J=(0,s.createContext)(null),X=(0,s.createContext)(null),ee=(0,s.forwardRef)(function(e,t){[e,t]=(0,j.useContextProps)(e,t,J);let{children:i,orientation:l="horizontal"}=e;return i=(0,s.useMemo)(()=>"function"==typeof i?i({orientation:l,defaultChildren:null}):i,[i,l]),s.default.createElement(T.CollectionBuilder,{content:i},i=>s.default.createElement(et,{props:e,collection:i,tabsRef:t}))});function et({props:e,tabsRef:t,collection:i}){let{orientation:l="horizontal"}=e,r=function(e){var t,i;let l=function(e){var t;let[i,l]=(0,Z.useControlledState)(e.selectedKey,null!=(t=e.defaultSelectedKey)?t:null,e.onSelectionChange),r=(0,s.useMemo)(()=>null!=i?[i]:[],[i]),{collection:a,disabledKeys:n,selectionManager:o}=function(e){var t,i;let l,{filter:r,layoutDelegate:a}=e,n=(0,G.useMultipleSelectionState)(e),o=(0,s.useMemo)(()=>e.disabledKeys?new Set(e.disabledKeys):new Set,[e.disabledKeys]),c=(0,s.useCallback)(e=>new $(r?r(e):e),[r]),d=(0,s.useMemo)(()=>({suppressTextValueWarning:e.suppressTextValueWarning}),[e.suppressTextValueWarning]),u=(0,Y.useCollection)(e,c,d),x=(0,s.useMemo)(()=>new(0,Q.SelectionManager)(u,n,{layoutDelegate:a}),[u,n,a]);return t=u,i=x,l=(0,s.useRef)(null),(0,s.useEffect)(()=>{if(null!=i.focusedKey&&!t.getItem(i.focusedKey)&&l.current){var e,s,r,a,n,o,c;let d=l.current.getItem(i.focusedKey),u=[...l.current.getKeys()].map(e=>{let t=l.current.getItem(e);return(null==t?void 0:t.type)==="item"?t:null}).filter(e=>null!==e),x=[...t.getKeys()].map(e=>{let s=t.getItem(e);return(null==s?void 0:s.type)==="item"?s:null}).filter(e=>null!==e),m=(null!=(e=null==u?void 0:u.length)?e:0)-(null!=(s=null==x?void 0:x.length)?s:0),g=Math.min(m>1?Math.max((null!=(r=null==d?void 0:d.index)?r:0)-m+1,0):null!=(a=null==d?void 0:d.index)?a:0,(null!=(n=null==x?void 0:x.length)?n:0)-1),p=null,f=!1;for(;g>=0;){if(!i.isDisabled(x[g].key)){p=x[g];break}g<x.length-1&&!f?g++:(f=!0,g>(null!=(o=null==d?void 0:d.index)?o:0)&&(g=null!=(c=null==d?void 0:d.index)?c:0),g--)}i.setFocusedKey(p?p.key:null)}l.current=t},[t,i]),{collection:u,disabledKeys:o,selectionManager:x}}({...e,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:r,onSelectionChange:t=>{var s;if("all"===t)return;let r=null!=(s=t.values().next().value)?s:null;r===i&&e.onSelectionChange&&e.onSelectionChange(r),l(r)}}),c=null!=i?a.getItem(i):null;return{collection:a,disabledKeys:n,selectionManager:o,selectedKey:i,setSelectedKey:l,selectedItem:c}}({...e,onSelectionChange:e.onSelectionChange?t=>{var s;null!=t&&(null==(s=e.onSelectionChange)||s.call(e,t))}:void 0,suppressTextValueWarning:!0,defaultSelectedKey:null!=(i=null!=(t=e.defaultSelectedKey)?t:q(e.collection,e.disabledKeys?new Set(e.disabledKeys):new Set))?i:void 0}),{selectionManager:r,collection:a,selectedKey:n}=l,o=(0,s.useRef)(n);return(0,s.useEffect)(()=>{let t=n;null==e.selectedKey&&(r.isEmpty||null==t||!a.getItem(t))&&null!=(t=q(a,l.disabledKeys))&&r.setSelectedKeys([t]),(null==t||null!=r.focusedKey)&&(r.isFocused||t===o.current)||r.setFocusedKey(t),o.current=t}),{...l,isDisabled:e.isDisabled||!1}}({...e,collection:i,children:void 0}),{focusProps:a,isFocused:n,isFocusVisible:o}=(0,k.useFocusRing)({within:!0}),c=(0,s.useMemo)(()=>({orientation:l,isFocusWithin:n,isFocusVisible:o}),[l,n,o]),d=(0,j.useRenderProps)({...e,defaultClassName:"react-aria-Tabs",values:c}),u=(0,z.filterDOMProps)(e,{global:!0});return s.default.createElement("div",{...(0,K.mergeProps)(u,d,a),ref:t,slot:e.slot||void 0,"data-focused":n||void 0,"data-orientation":l,"data-focus-visible":o||void 0,"data-disabled":r.isDisabled||void 0},s.default.createElement(j.Provider,{values:[[J,e],[X,r]]},d.children))}let es=(0,s.forwardRef)(function(e,t){return(0,s.useContext)(X)?s.default.createElement(ei,{props:e,forwardedRef:t}):s.default.createElement(T.Collection,e)});function ei({props:e,forwardedRef:t}){let i=(0,s.useContext)(X),{CollectionRoot:l}=(0,s.useContext)(N.CollectionRendererContext),{orientation:r="horizontal",keyboardActivation:a="automatic"}=(0,j.useSlottedContext)(J),n=(0,H.useObjectRef)(t),{tabListProps:o}=function(e,t,i){let{orientation:l="horizontal",keyboardActivation:r="automatic"}=e,{collection:a,selectionManager:n,disabledKeys:o}=t,{direction:c}=(0,L.useLocale)(),d=(0,s.useMemo)(()=>new P(a,c,l,o),[a,o,l,c]),{collectionProps:u}=(0,D.useSelectableCollection)({ref:i,selectionManager:n,keyboardDelegate:d,selectOnFocus:"automatic"===r,disallowEmptySelection:!0,scrollRef:i,linkBehavior:"selection"}),x=(0,M.useId)();S.set(t,x);let m=(0,E.useLabels)({...e,id:x});return{tabListProps:{...(0,K.mergeProps)(u,m),role:"tablist","aria-orientation":l,tabIndex:void 0}}}({...e,orientation:r,keyboardActivation:a},i,n),c=(0,j.useRenderProps)({...e,children:null,defaultClassName:"react-aria-TabList",values:{orientation:r,state:i}}),d=(0,z.filterDOMProps)(e,{global:!0});return delete d.id,s.default.createElement("div",{...(0,K.mergeProps)(d,c,o),ref:n,"data-orientation":r||void 0},s.default.createElement(w.SharedElementTransition,null,s.default.createElement(l,{collection:i.collection,persistedKeys:(0,N.usePersistedKeys)(i.selectionManager.focusedKey)})))}class el extends O.CollectionNode{}el.type="item";let er=(0,T.createLeafComponent)(el,(e,t,i)=>{let l=(0,s.useContext)(X),r=(0,H.useObjectRef)(t),{tabProps:a,isSelected:n,isDisabled:o,isPressed:c}=function(e,t,s){let{key:i,isDisabled:l,shouldSelectOnPressUp:r}=e,{selectionManager:a,selectedKey:n}=t,o=i===n,c=l||t.isDisabled||t.selectionManager.isDisabled(i),{itemProps:d,isPressed:u}=(0,F.useSelectableItem)({selectionManager:a,key:i,ref:s,isDisabled:c,shouldSelectOnPressUp:r,linkBehavior:"selection"}),x=I(t,i,"tab"),m=I(t,i,"tabpanel"),{tabIndex:g}=d,p=t.collection.getItem(i),f=(0,z.filterDOMProps)(null==p?void 0:p.props,{labelable:!0});delete f.id;let h=(0,A.useLinkProps)(null==p?void 0:p.props),{focusableProps:y}=(0,R.useFocusable)({isDisabled:c},s);return{tabProps:(0,K.mergeProps)(f,y,h,d,{id:x,"aria-selected":o,"aria-disabled":c||void 0,"aria-controls":o?m:void 0,tabIndex:c?void 0:g,role:"tab"}),isSelected:o,isDisabled:c,isPressed:u}}({key:i.key,...e},l,r),{focusProps:d,isFocused:u,isFocusVisible:x}=(0,k.useFocusRing)(),{hoverProps:m,isHovered:g}=(0,_.useHover)({isDisabled:o,onHoverStart:e.onHoverStart,onHoverEnd:e.onHoverEnd,onHoverChange:e.onHoverChange}),p=(0,j.useRenderProps)({...e,id:void 0,children:i.rendered,defaultClassName:"react-aria-Tab",values:{isSelected:n,isDisabled:o,isFocused:u,isFocusVisible:x,isPressed:c,isHovered:g}}),f=i.props.href?"a":"div",h=(0,z.filterDOMProps)(e,{global:!0});return delete h.id,delete h.onClick,s.default.createElement(f,{...(0,K.mergeProps)(h,p,a,d,m),ref:r,"data-selected":n||void 0,"data-disabled":o||void 0,"data-focused":u||void 0,"data-focus-visible":x||void 0,"data-pressed":c||void 0,"data-hovered":g||void 0},s.default.createElement(C.SelectionIndicatorContext.Provider,{value:{isSelected:n}},p.children))}),ea=(0,V.createHideableComponent)(function(e,t){let i=(0,s.useContext)(X),l=(0,H.useObjectRef)(t),r=i.selectedKey===e.id,[a,n]=(0,s.useState)(null!=i.selectedKey?r:null);null==a&&null!=i.selectedKey?n(r):!r&&a&&n(!1);let o=(0,U.useExitAnimation)(l,r);return r||e.shouldForceMount||o?s.default.createElement(en,{...e,tabPanelRef:l,isInitiallySelected:a||!1,isExiting:o}):null});function en(e){var t;let i,l,r,a=(0,s.useContext)(X),{id:n,tabPanelRef:o,isInitiallySelected:c,isExiting:d,...u}=e,{tabPanelProps:x}=(i=(0,B.useHasTabbableChild)(o)?void 0:0,l=I(a,null!=(t=e.id)?t:null==a?void 0:a.selectedKey,"tabpanel"),r=(0,E.useLabels)({...e,id:l,"aria-labelledby":I(a,null==a?void 0:a.selectedKey,"tab")}),{tabPanelProps:(0,K.mergeProps)(r,{tabIndex:i,role:"tabpanel","aria-describedby":e["aria-describedby"],"aria-details":e["aria-details"]})}),{focusProps:m,isFocused:g,isFocusVisible:p}=(0,k.useFocusRing)(),f=a.selectedKey===e.id,h=(0,U.useEnterAnimation)(o)&&!c,y=(0,j.useRenderProps)({...e,defaultClassName:"react-aria-TabPanel",values:{isFocused:g,isFocusVisible:p,isInert:(0,W.inertValue)(!f),isEntering:h,isExiting:d,state:a}}),b=(0,z.filterDOMProps)(u,{global:!0});delete b.id;let v=f?(0,K.mergeProps)(b,x,m,y):(0,K.mergeProps)(b,y);return s.default.createElement("div",{...v,ref:o,"data-focused":g||void 0,"data-focus-visible":p||void 0,inert:(0,W.inertValue)(!f||e.inert),"data-inert":f?void 0:"true","data-entering":h||void 0,"data-exiting":d||void 0},s.default.createElement(j.Provider,{values:[[J,null],[X,null]]},s.default.createElement(N.CollectionRendererContext.Provider,{value:N.DefaultCollectionRenderer},y.children)))}var eo=e.i(72395);let ec={sm:{"button-brand":"text-sm font-semibold py-2 px-3","button-gray":"text-sm font-semibold py-2 px-3","button-border":"text-sm font-semibold py-2 px-3","button-minimal":"text-sm font-semibold py-2 px-3",underline:"text-sm font-semibold px-1 pb-2.5 pt-0",line:"text-sm font-semibold pl-2.5 pr-3 py-0.5"},md:{"button-brand":"text-md font-semibold py-2.5 px-3","button-gray":"text-md font-semibold py-2.5 px-3","button-border":"text-md font-semibold py-2.5 px-3","button-minimal":"text-md font-semibold py-2.5 px-3",underline:"text-md font-semibold px-1 pb-2.5 pt-0",line:"text-md font-semibold pr-3.5 pl-3 py-1"}},ed=(0,s.createContext)({size:"sm",type:"button-brand"}),eu=e=>{let{label:i,children:l,badge:r,...a}=e,{size:n="sm",type:o="button-brand",fullWidth:c}=(0,s.useContext)(ed);return(0,t.jsx)(er,{...a,className:t=>(0,eo.cx)("z-10 flex h-max cursor-pointer items-center justify-center gap-2 rounded-md whitespace-nowrap text-quaternary transition duration-100 ease-linear","group-orientation-vertical:justify-start",c&&"w-full flex-1",ec[n][o],(({isFocusVisible:e,isSelected:t,isHovered:s})=>({"button-brand":(0,eo.cx)("outline-focus-ring",e&&"outline-2 -outline-offset-2",(t||s)&&"bg-brand-primary_alt text-brand-secondary"),"button-gray":(0,eo.cx)("outline-focus-ring",s&&"bg-primary_hover text-secondary",e&&"outline-2 -outline-offset-2",t&&"bg-active text-secondary"),"button-border":(0,eo.cx)("outline-focus-ring",(t||s)&&"bg-primary_alt text-secondary shadow-sm",e&&"outline-2 -outline-offset-2"),"button-minimal":(0,eo.cx)("rounded-lg outline-focus-ring",s&&"text-secondary",e&&"outline-2 -outline-offset-2",t&&"bg-primary_alt text-secondary shadow-xs ring-1 ring-primary ring-inset"),underline:(0,eo.cx)("rounded-none border-b-2 border-transparent outline-focus-ring",(t||s)&&"border-fg-brand-primary_alt text-brand-secondary",e&&"outline-2 -outline-offset-2"),line:(0,eo.cx)("rounded-none border-l-2 border-transparent outline-focus-ring",(t||s)&&"border-fg-brand-primary_alt text-brand-secondary",e&&"outline-2 -outline-offset-2")}))(t)[o],"function"==typeof e.className?e.className(t):e.className),children:e=>(0,t.jsxs)(s.Fragment,{children:["function"==typeof l?l(e):l||i,r&&(0,t.jsx)(b.Badge,{size:n,type:"pill-color",color:(({isSelected:e,isHovered:t})=>({"button-brand":e||t?"brand":"gray","button-gray":"gray","button-border":"gray","button-minimal":"gray",underline:e||t?"brand":"gray",line:e||t?"brand":"gray"}))(e)[o],className:(0,eo.cx)("hidden transition-inherit-all md:flex","sm"===n&&"-my-px"),children:r})]})})},ex=({className:e,...s})=>(0,t.jsx)(ee,{keyboardActivation:"manual",...s,className:t=>(0,eo.cx)("flex w-full flex-col","function"==typeof e?e(t):e)});ex.Panel=e=>(0,t.jsx)(ea,{...e,className:t=>(0,eo.cx)("outline-focus-ring focus-visible:outline-2 focus-visible:outline-offset-2","function"==typeof e.className?e.className(t):e.className)}),ex.List=({size:e="sm",type:s="button-brand",orientation:i,fullWidth:l,className:r,children:a,...n})=>{let o=(0,j.useSlottedContext)(J),c=i??o?.orientation??"horizontal";return(0,t.jsx)(ed.Provider,{value:{size:e,type:s,orientation:c,fullWidth:l},children:(0,t.jsx)(es,{...n,className:t=>(0,eo.cx)("group flex",(({size:e,fullWidth:t})=>({"button-brand":"gap-1","button-gray":"gap-1","button-border":(0,eo.cx)("gap-1 rounded-[10px] bg-secondary_alt p-1 ring-1 ring-secondary ring-inset","md"===e&&"rounded-xl p-1.5"),"button-minimal":"gap-0.5 rounded-lg bg-secondary_alt ring-1 ring-inset ring-secondary",underline:(0,eo.cx)("gap-3",t&&"w-full gap-4"),line:"gap-2"}))({size:e,fullWidth:l})[s],"vertical"===c&&"w-max flex-col","horizontal"===c&&"underline"===s&&"relative before:absolute before:inset-x-0 before:bottom-0 before:h-px before:bg-border-secondary","function"==typeof r?r(t):r),children:a??(e=>(0,t.jsx)(eu,{...e,children:e.children}))})})},ex.Item=eu,e.i(67918);var em=e.i(5016),eg=e.i(33880),eg=eg,ep=e.i(66457),ef=e.i(24040),eh=e.i(69331),ey=e.i(1851);function eb(){let[e,j]=(0,s.useState)("active"),[N,C]=(0,s.useState)(null),[w,k]=(0,s.useState)(""),[K,S]=(0,s.useState)(!1),[I,P]=(0,s.useState)([]),[M,E]=(0,s.useState)([]),[L,D]=(0,s.useState)(!1),[z,A]=(0,s.useState)(!1),[R,F]=(0,s.useState)(!1),_=(0,s.useRef)(!1),B=(0,s.useRef)(null),T=I.find(e=>e._id===N);(0,s.useEffect)(()=>{let t=async()=>{D(!0);try{var t;let s,i=(await (s=(t=e)?`?status=${t}`:"",ef.apiClient.get(`/chats${s}`))).map(e=>{let t=e.visitorId;return{...e,customerName:t?.name||"Visitor "+t?._id?.substring(0,4),countryCode:t?.location?.country||"US",visitorInfo:W(t)}});P(i),i.length>0?N&&i.find(e=>e._id===N)||C(i[0]._id):C(null)}catch(e){console.error("Failed to fetch chats:",e)}finally{D(!1)}};t();let s=setInterval(t,1e4);return()=>clearInterval(s)},[e]);let O=(0,s.useRef)(null);(0,s.useEffect)(()=>{if(!N||!T?.visitorId)return;let e=T.visitorId._id;e===O.current||(async()=>{A(!0);try{let t;O.current=e;let s=await (t=e,ef.apiClient.get(`/chats/history/${t}`));E(s)}catch(e){console.error("Failed to fetch history:",e),O.current=null}finally{A(!1)}})()},[N,T?.visitorId]);let V=(0,s.useRef)(N),H=(0,s.useRef)(null);(0,s.useEffect)(()=>{V.current=N,H.current=T?.visitorId?T.visitorId._id:null},[N,T]),(0,s.useEffect)(()=>{eh.socketService.connect();let e=new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/pang/pop.mp3"),t=eh.socketService.on("new-message",t=>{console.log("ChatPage handleNewMessage:",t._id),"visitor"===t.sender&&e.play().catch(e=>console.log("Audio play failed:",e)),P(e=>e.map(e=>{if(e.visitorId?._id===t.visitorId){let s=e._id===V.current;return{...e,lastMessage:t.text,updatedAt:t.createdAt,unreadCount:s||"agent"===t.sender?e.unreadCount||0:(e.unreadCount||0)+1}}return e})),t.visitorId===H.current&&E(e=>e.some(e=>e._id===t._id)?e:[...e,t])});return()=>{t(),eh.socketService.disconnect()}},[]),(0,s.useEffect)(()=>{B.current?.scrollIntoView({behavior:"smooth"})},[M]);let U=async()=>{let e;if(w.trim()&&T){if(_.current)return void console.log("Message sending already in progress");if(T.visitorId&&"object"==typeof T.visitorId&&"_id"in T.visitorId?e=T.visitorId._id:"string"==typeof T.visitorId&&(e=T.visitorId),console.log("Sending message to visitor:",e,"for chat:",T._id),!e){console.error("Cannot send message: Missing visitor ID for chat",T),alert("Error: Cannot identify visitor for this chat. Please refresh or try another chat.");return}_.current=!0,F(!0);try{let t,s,i=await (t=e,s=w,ef.apiClient.post(`/chats/${t}/message`,{text:s,sender:"agent"}));console.log("Message sent successfully via API"),i&&(E(e=>e.some(e=>e._id===i._id)?e:[...e,i]),P(e=>e.map(e=>e.visitorId&&e.visitorId._id===i.visitorId?{...e,lastMessage:i.text,updatedAt:i.createdAt,unreadCount:0}:e))),k("")}catch(e){console.error("Failed to send message:",e),alert("Failed to send message. Please try again.")}finally{setTimeout(()=>{_.current=!1,F(!1)},100)}}},W=e=>({browserType:"Chrome",browserVersion:"Latest",referralLink:"",ipAddress:e?.ip||"",javaSupport:!1,cookieSupport:!0,characterEncoding:"UTF-8",languageAccepted:"en-US",screenResolution:"1920x1080",colorDepth:24,operatingSystem:"Windows",userAgent:e?.userAgent||"",visitorLocation:{city:e?.location?.city||"Unknown",state:"",country:e?.location?.country||"Unknown",countryCode:"US",latitude:0,longitude:0,locationLink:""}});return(0,t.jsxs)("div",{className:"flex h-[calc(100vh-64px)] w-full bg-white overflow-hidden",children:[(0,t.jsxs)("div",{className:"w-80 flex flex-col border-r border-gray-200 h-full shrink-0",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"My Chats"}),(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:i.FilterLines,onClick:()=>console.log("Filter clicked")})]}),(0,t.jsx)("div",{className:"px-2 pt-2",children:(0,t.jsx)(ex,{selectedKey:e,onSelectionChange:e=>j(e),className:"w-full",children:(0,t.jsxs)(ex.List,{type:"underline",fullWidth:!0,items:[],children:[(0,t.jsx)(ex.Item,{id:"active",children:"Active"}),(0,t.jsx)(ex.Item,{id:"missed",children:"Missed"}),(0,t.jsx)(ex.Item,{id:"closed",children:"Closed"})]})})}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto",children:L?(0,t.jsx)("div",{className:"p-8 text-center text-gray-500 text-sm",children:"Loading chats..."}):0===I.length?(0,t.jsxs)("div",{className:"p-8 text-center text-gray-500 text-sm",children:["No ",e," chats"]}):I.map(e=>(0,t.jsxs)("div",{onClick:()=>C(e._id),className:(0,eo.cx)("p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors",N===e._id?"bg-blue-50/50":""),children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Globe01,{className:"size-3 text-gray-400"}),(0,t.jsx)("span",{className:"font-medium text-sm text-gray-900",children:e.customerName}),(0,t.jsxs)("span",{className:"text-xs text-gray-500",children:["#",e.chatId?.substring(0,6)]})]}),(0,t.jsx)("span",{className:"text-xs text-gray-500",children:e.lastMessageAt?(0,ey.format)(new Date(e.lastMessageAt),"HH:mm"):""})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600 truncate",children:e.lastMessage||"No messages"}),e.unreadCount?(0,t.jsx)("div",{className:"mt-2 flex justify-end",children:(0,t.jsx)(b.Badge,{size:"sm",color:"brand",type:"pill-color",children:e.unreadCount})}):null]},e._id))})]}),T?(0,t.jsxs)("div",{className:"flex-1 flex flex-col h-full min-w-0",children:[(0,t.jsxs)("div",{className:"h-16 border-b border-gray-200 flex items-center justify-between px-6 bg-white shrink-0",children:[(0,t.jsxs)("div",{className:"flex flex-col",children:[(0,t.jsx)("div",{className:"flex items-center gap-2",children:(0,t.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["#",T.chatId?.substring(0,8)]})}),(0,t.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(g.Building02,{className:"size-3"}),(0,t.jsx)("span",{children:"SALES IQ"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(m.User01,{className:"size-3"}),(0,t.jsx)("span",{children:"SALES IQ"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-1",children:[(0,t.jsx)(m.User01,{className:"size-3"}),(0,t.jsx)("span",{children:"SALES IQ"})]})]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:p.DotsVertical}),(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:x})]})]}),(0,t.jsxs)("div",{className:"px-6 py-2 border-b border-gray-100 flex items-center gap-2",children:[(0,t.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Conversation tags"}),(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",className:"rounded-full !p-1 h-6 w-6 rotate-45",children:(0,t.jsx)(n,{className:"size-4"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-white",children:z?(0,t.jsx)("div",{className:"text-center text-gray-500 text-sm mt-10",children:"Loading history..."}):0===M.length?(0,t.jsx)("div",{className:"text-center text-gray-500 text-sm mt-10",children:"No messages yet"}):(0,t.jsxs)(t.Fragment,{children:[M.map(e=>{if("system"===e.sender)return(0,t.jsxs)("div",{className:"flex items-center gap-4 py-4",children:[(0,t.jsx)("div",{className:"h-px bg-gray-200 flex-1"}),(0,t.jsx)("span",{className:"text-xs text-gray-400",children:e.text}),(0,t.jsx)("div",{className:"h-px bg-gray-200 flex-1"})]},e._id);let s="agent"===e.sender;return(0,t.jsxs)("div",{className:(0,eo.cx)("flex gap-3 group",s?"flex-row-reverse":""),children:[(0,t.jsx)(h.Avatar,{initials:s?"A":T.customerName.charAt(0),size:"sm",className:(0,eo.cx)("text-xs",s?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600")}),(0,t.jsxs)("div",{className:(0,eo.cx)("max-w-[80%]",s?"text-right":""),children:[(0,t.jsx)("div",{className:(0,eo.cx)("flex items-baseline gap-2 mb-1",s?"justify-end":""),children:(0,t.jsx)("span",{className:"text-sm font-medium text-gray-900",children:s?"Agent":T.customerName})}),(0,t.jsx)("div",{className:(0,eo.cx)("rounded-lg px-4 py-2 inline-block text-left",s?"bg-blue-600 text-white rounded-tr-none":"bg-gray-100 text-gray-800 rounded-tl-none"),children:(0,t.jsx)("p",{className:"text-sm",children:e.text})}),(0,t.jsx)("span",{className:"text-xs text-gray-400 ml-2 group-hover:opacity-100 opacity-0 transition-opacity block mt-1",children:(0,ey.format)(new Date(e.createdAt),"hh:mm a")})]})]},e._id)}),(0,t.jsx)("div",{ref:B})]})}),(0,t.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:"closed"===T.status?(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(b.BadgeWithIcon,{color:"success",size:"lg",iconLeading:f,children:"CHAT COMPLETED"}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Ended due to chat idle timeout ",(0,t.jsx)("span",{className:"text-blue-600 cursor-pointer",children:"Show details"})]})]}),(0,t.jsx)(y.Button,{color:"primary",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>console.log("Reply via email clicked"),children:"Reply via Email"})]}):(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsx)(v.Input,{placeholder:"Type a message...",value:w,onChange:e=>k(e),onKeyDown:e=>{"Enter"!==e.key||_.current||(e.preventDefault(),U())},className:"pr-24",isDisabled:R}),(0,t.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:a.FaceSmile,onClick:()=>console.log("Emoji picker clicked"),disabled:R}),(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:r.Paperclip,onClick:()=>console.log("Attach file clicked"),disabled:R}),(0,t.jsx)(y.Button,{size:"sm",color:"primary",iconLeading:l.Send01,onClick:U,disabled:R})]})]})})]}):(0,t.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50 text-gray-500",children:"Select a chat to start conversation"}),T&&(0,t.jsxs)("div",{className:"w-80 border-l border-gray-200 bg-white flex flex-col h-full overflow-y-auto shrink-0",children:[(0,t.jsxs)("div",{className:"p-6 border-b border-gray-100",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,t.jsxs)("div",{className:"flex gap-3",children:[(0,t.jsx)(h.Avatar,{initials:T.customerName.charAt(0),size:"lg",className:"bg-pink-100 text-pink-600 text-lg"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900",children:T.customerName}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:T.visitorInfo.visitorLocation.locationLink||"Unknown Location"})]})]}),(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:o,onClick:()=>console.log("Edit customer clicked")})]}),(0,t.jsxs)("div",{className:"space-y-3",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:(0,t.jsx)("span",{className:"truncate max-w-[180px]",children:T.visitorId?.email||"No email"})}),(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",iconLeading:c.Copy01,className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>console.log("Email copied")})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[(0,t.jsx)(d.Globe01,{className:"size-4 text-gray-400"}),(0,t.jsx)("span",{children:(0,ey.format)(new Date,"dd MMM, yyyy hh:mm a")})]}),(0,t.jsx)("div",{className:"flex items-center gap-2 text-sm text-blue-600 cursor-pointer hover:underline",onClick:()=>S(!0),children:(0,t.jsxs)("span",{className:"flex items-center gap-2",children:[(0,t.jsx)("div",{className:"size-4 rounded-full border border-current flex items-center justify-center text-[10px] font-bold",children:"i"})," More info"]})})]}),(0,t.jsx)("div",{className:"mt-6",children:(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-900 mb-2",children:[(0,t.jsx)(y.Button,{size:"sm",color:"tertiary",className:"rounded-full !p-0.5 h-5 w-5 rotate-45 bg-gray-200 text-gray-600",children:(0,t.jsx)(n,{className:"size-3"})}),"Contact tags"]})})]}),(0,t.jsxs)("div",{className:"p-6 space-y-4",children:[(0,t.jsx)(ev,{label:"Type",value:"New Visitor"}),(0,t.jsx)(ev,{label:"Source",value:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Monitor01,{className:"size-4 text-gray-400"}),(0,t.jsx)(eg.default,{className:"size-4 text-gray-400"}),(0,t.jsx)(em.Google,{className:"size-4 text-gray-400"})]})}),(0,t.jsx)(ev,{label:"IP address",value:T.visitorInfo.ipAddress}),(0,t.jsx)(ev,{label:"Chat initiated page",value:(0,t.jsx)("span",{className:"text-blue-600 truncate block max-w-[150px]",children:T.visitorInfo.referralLink||"Direct"})}),(0,t.jsx)(ev,{label:"Current Page",value:(0,t.jsx)("span",{className:"text-blue-600 truncate block max-w-[150px]",children:T.visitorId?.currentPage||"/"})})]})]}),(0,t.jsx)(ep.SlideoutMenu,{isOpen:K,onOpenChange:S,children:(0,t.jsxs)(ep.SlideoutMenu.Content,{children:[(0,t.jsx)(ep.SlideoutMenu.Header,{onClose:()=>S(!1),children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(u.Monitor01,{className:"size-5 text-gray-500"}),(0,t.jsx)("span",{className:"font-semibold text-gray-900 uppercase",children:"VISITOR INFORMATION"})]})}),T&&(0,t.jsxs)("div",{className:"space-y-8 p-6",children:[(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4 uppercase tracking-wider",children:"Browser Information"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8",children:[(0,t.jsx)(ej,{label:"Browser",value:T.visitorInfo.browserType}),(0,t.jsx)(ej,{label:"Version",value:T.visitorInfo.browserVersion}),(0,t.jsx)(ej,{label:"OS",value:T.visitorInfo.operatingSystem}),(0,t.jsx)(ej,{label:"Resolution",value:T.visitorInfo.screenResolution}),(0,t.jsx)(ej,{label:"User Agent",value:T.visitorInfo.userAgent,className:"col-span-2 break-all"})]})]}),(0,t.jsx)("div",{className:"h-px bg-gray-100"}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4 uppercase tracking-wider",children:"Location"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8",children:[(0,t.jsx)(ej,{label:"City",value:T.visitorInfo.visitorLocation.city}),(0,t.jsx)(ej,{label:"Country",value:T.visitorInfo.visitorLocation.country}),(0,t.jsx)(ej,{label:"IP Address",value:T.visitorInfo.ipAddress})]})]}),(0,t.jsx)("div",{className:"h-px bg-gray-100"}),(0,t.jsxs)("section",{children:[(0,t.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4 uppercase tracking-wider",children:"Technical Details"}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8",children:[(0,t.jsx)(ej,{label:"Java Enabled",value:T.visitorInfo.javaSupport?"Yes":"No"}),(0,t.jsx)(ej,{label:"Cookies Enabled",value:T.visitorInfo.cookieSupport?"Yes":"No"}),(0,t.jsx)(ej,{label:"Color Depth",value:`${T.visitorInfo.colorDepth}-bit`}),(0,t.jsx)(ej,{label:"Character Encoding",value:T.visitorInfo.characterEncoding})]})]})]})]})})]})}function ev({label:e,value:s}){return(0,t.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,t.jsx)("span",{className:"text-gray-500",children:e}),(0,t.jsx)("span",{className:"text-gray-900 font-medium",children:s})]})}function ej({label:e,value:s,className:i}){return(0,t.jsxs)("div",{className:i,children:[(0,t.jsx)("dt",{className:"text-xs text-gray-500 mb-1",children:e}),(0,t.jsx)("dd",{className:"text-sm font-medium text-gray-900",children:s||"-"})]})}e.s(["default",()=>eb],37142)}]);