module.exports=[37314,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(87744),e=a.i(58357),f=a.i(53278),g=a.i(74940);let h=({size:a=24,color:b="currentColor",...d})=>c.createElement("svg",{viewBox:"0 0 24 24",width:a,height:a,stroke:b,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...d},c.createElement("path",{d:"M18 6 6 18M6 6l12 12"}));h.displayName="XClose";let i=({size:a=24,color:b="currentColor",...d})=>c.createElement("svg",{viewBox:"0 0 24 24",width:a,height:a,stroke:b,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...d},c.createElement("path",{d:"m18 10-4-4M2.5 21.5l3.384-.376c.414-.046.62-.069.814-.131a2 2 0 0 0 .485-.234c.17-.111.317-.259.61-.553L21 7a2.828 2.828 0 1 0-4-4L3.794 16.206c-.294.294-.442.442-.553.611a2 2 0 0 0-.234.485c-.062.193-.085.4-.131.814L2.5 21.5Z"}));i.displayName="Edit02";var j=a.i(63313),k=a.i(76829),l=a.i(76175);let m=({size:a=24,color:b="currentColor",...d})=>c.createElement("svg",{viewBox:"0 0 24 24",width:a,height:a,stroke:b,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...d},c.createElement("path",{d:"m18 15-6-6-6 6"}));m.displayName="ChevronUp";var n=a.i(22337),o=a.i(89471),p=a.i(52536);let q=({size:a=24,color:b="currentColor",...d})=>c.createElement("svg",{viewBox:"0 0 24 24",width:a,height:a,stroke:b,strokeWidth:"2",fill:"none",strokeLinecap:"round",strokeLinejoin:"round","aria-hidden":"true",...d},c.createElement("path",{d:"m7.5 12 3 3 6-6m5.5 3c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2s10 4.477 10 10Z"}));q.displayName="CheckCircle";var r=a.i(33403),s=a.i(52507),t=a.i(37819),u=a.i(15009),v=a.i(28303),w=a.i(27442),x=a.i(82754),y=a.i(32453),z=a.i(343),A=a.i(91759);let B=new WeakMap;function C(a,b,c){if(!a)return"";"string"==typeof b&&(b=b.replace(/\s+/g,""));let d=B.get(a);return`${d}-${c}-${b}`}class D{getKeyLeftOf(a){return this.flipDirection?this.getNextKey(a):this.getPreviousKey(a)}getKeyRightOf(a){return this.flipDirection?this.getPreviousKey(a):this.getNextKey(a)}isDisabled(a){var b,c;return this.disabledKeys.has(a)||!!(null==(c=this.collection.getItem(a))||null==(b=c.props)?void 0:b.isDisabled)}getFirstKey(){let a=this.collection.getFirstKey();return null!=a&&this.isDisabled(a)&&(a=this.getNextKey(a)),a}getLastKey(){let a=this.collection.getLastKey();return null!=a&&this.isDisabled(a)&&(a=this.getPreviousKey(a)),a}getKeyAbove(a){return this.tabDirection?null:this.getPreviousKey(a)}getKeyBelow(a){return this.tabDirection?null:this.getNextKey(a)}getNextKey(a){let b=a;do null==(b=this.collection.getKeyAfter(b))&&(b=this.collection.getFirstKey());while(null!=b&&this.isDisabled(b))return b}getPreviousKey(a){let b=a;do null==(b=this.collection.getKeyBefore(b))&&(b=this.collection.getLastKey());while(null!=b&&this.isDisabled(b))return b}constructor(a,b,c,d=new Set){this.collection=a,this.flipDirection="rtl"===b&&"horizontal"===c,this.disabledKeys=d,this.tabDirection="horizontal"===c}}var E=a.i(90953),F=a.i(93243),G=a.i(66351),H=a.i(64826),I=a.i(54200),J=a.i(86546),K=a.i(7186),L=a.i(37603),M=a.i(12564),N=a.i(40352),O=a.i(90116),P=a.i(2818),Q=a.i(45891),R=a.i(19789);a.i(66052);var S=a.i(84442),T=a.i(44683);class U{*[Symbol.iterator](){yield*this.iterable}get size(){return this._size}getKeys(){return this.keyMap.keys()}getKeyBefore(a){var b;let c=this.keyMap.get(a);return c&&null!=(b=c.prevKey)?b:null}getKeyAfter(a){var b;let c=this.keyMap.get(a);return c&&null!=(b=c.nextKey)?b:null}getFirstKey(){return this.firstKey}getLastKey(){return this.lastKey}getItem(a){var b;return null!=(b=this.keyMap.get(a))?b:null}at(a){let b=[...this.getKeys()];return this.getItem(b[a])}getChildren(a){let b=this.keyMap.get(a);return(null==b?void 0:b.childNodes)||[]}constructor(a){var b;this.keyMap=new Map,this.firstKey=null,this.lastKey=null,this.iterable=a;let c=a=>{if(this.keyMap.set(a.key,a),a.childNodes&&"section"===a.type)for(let b of a.childNodes)c(b)};for(let b of a)c(b);let d=null,e=0,f=0;for(let[a,b]of this.keyMap)d?(d.nextKey=a,b.prevKey=d.key):(this.firstKey=a,b.prevKey=void 0),"item"===b.type&&(b.index=e++),("section"===b.type||"item"===b.type)&&f++,(d=b).nextKey=void 0;this._size=f,this.lastKey=null!=(b=null==d?void 0:d.key)?b:null}}var V=a.i(59364),W=a.i(66362),X=a.i(2655),Y=a.i(39668);function Z(a,b){let c=null;if(a){var d,e,f,g;for(c=a.getFirstKey();null!=c&&(b.has(c)||(null==(e=a.getItem(c))||null==(d=e.props)?void 0:d.isDisabled))&&c!==a.getLastKey();)c=a.getKeyAfter(c);null!=c&&(b.has(c)||(null==(g=a.getItem(c))||null==(f=g.props)?void 0:f.isDisabled))&&c===a.getLastKey()&&(c=a.getFirstKey())}return c}let $=(0,c.createContext)(null),_=(0,c.createContext)(null),aa=(0,c.forwardRef)(function(a,b){[a,b]=(0,v.useContextProps)(a,b,$);let{children:d,orientation:e="horizontal"}=a;return d=(0,c.useMemo)(()=>"function"==typeof d?d({orientation:e,defaultChildren:null}):d,[d,e]),c.default.createElement(O.CollectionBuilder,{content:d},d=>c.default.createElement(ab,{props:a,collection:d,tabsRef:b}))});function ab({props:a,tabsRef:b,collection:d}){let{orientation:e="horizontal"}=a,f=function(a){var b,d;let e=function(a){var b;let[d,e]=(0,Y.useControlledState)(a.selectedKey,null!=(b=a.defaultSelectedKey)?b:null,a.onSelectionChange),f=(0,c.useMemo)(()=>null!=d?[d]:[],[d]),{collection:g,disabledKeys:h,selectionManager:i}=function(a){var b,d;let e,{filter:f,layoutDelegate:g}=a,h=(0,V.useMultipleSelectionState)(a),i=(0,c.useMemo)(()=>a.disabledKeys?new Set(a.disabledKeys):new Set,[a.disabledKeys]),j=(0,c.useCallback)(a=>new U(f?f(a):a),[f]),k=(0,c.useMemo)(()=>({suppressTextValueWarning:a.suppressTextValueWarning}),[a.suppressTextValueWarning]),l=(0,X.useCollection)(a,j,k),m=(0,c.useMemo)(()=>new(0,W.SelectionManager)(l,h,{layoutDelegate:g}),[l,h,g]);return b=l,d=m,e=(0,c.useRef)(null),(0,c.useEffect)(()=>{if(null!=d.focusedKey&&!b.getItem(d.focusedKey)&&e.current){var a,c,f,g,h,i,j;let k=e.current.getItem(d.focusedKey),l=[...e.current.getKeys()].map(a=>{let b=e.current.getItem(a);return(null==b?void 0:b.type)==="item"?b:null}).filter(a=>null!==a),m=[...b.getKeys()].map(a=>{let c=b.getItem(a);return(null==c?void 0:c.type)==="item"?c:null}).filter(a=>null!==a),n=(null!=(a=null==l?void 0:l.length)?a:0)-(null!=(c=null==m?void 0:m.length)?c:0),o=Math.min(n>1?Math.max((null!=(f=null==k?void 0:k.index)?f:0)-n+1,0):null!=(g=null==k?void 0:k.index)?g:0,(null!=(h=null==m?void 0:m.length)?h:0)-1),p=null,q=!1;for(;o>=0;){if(!d.isDisabled(m[o].key)){p=m[o];break}o<m.length-1&&!q?o++:(q=!0,o>(null!=(i=null==k?void 0:k.index)?i:0)&&(o=null!=(j=null==k?void 0:k.index)?j:0),o--)}d.setFocusedKey(p?p.key:null)}e.current=b},[b,d]),{collection:l,disabledKeys:i,selectionManager:m}}({...a,selectionMode:"single",disallowEmptySelection:!0,allowDuplicateSelectionEvents:!0,selectedKeys:f,onSelectionChange:b=>{var c;if("all"===b)return;let f=null!=(c=b.values().next().value)?c:null;f===d&&a.onSelectionChange&&a.onSelectionChange(f),e(f)}}),j=null!=d?g.getItem(d):null;return{collection:g,disabledKeys:h,selectionManager:i,selectedKey:d,setSelectedKey:e,selectedItem:j}}({...a,onSelectionChange:a.onSelectionChange?b=>{var c;null!=b&&(null==(c=a.onSelectionChange)||c.call(a,b))}:void 0,suppressTextValueWarning:!0,defaultSelectedKey:null!=(d=null!=(b=a.defaultSelectedKey)?b:Z(a.collection,a.disabledKeys?new Set(a.disabledKeys):new Set))?d:void 0}),{selectionManager:f,collection:g,selectedKey:h}=e,i=(0,c.useRef)(h);return(0,c.useEffect)(()=>{let b=h;null==a.selectedKey&&(f.isEmpty||null==b||!g.getItem(b))&&null!=(b=Z(g,e.disabledKeys))&&f.setSelectedKeys([b]),(null==b||null!=f.focusedKey)&&(f.isFocused||b===i.current)||f.setFocusedKey(b),i.current=b}),{...e,isDisabled:a.isDisabled||!1}}({...a,collection:d,children:void 0}),{focusProps:g,isFocused:h,isFocusVisible:i}=(0,z.useFocusRing)({within:!0}),j=(0,c.useMemo)(()=>({orientation:e,isFocusWithin:h,isFocusVisible:i}),[e,h,i]),k=(0,v.useRenderProps)({...a,defaultClassName:"react-aria-Tabs",values:j}),l=(0,I.filterDOMProps)(a,{global:!0});return c.default.createElement("div",{...(0,A.mergeProps)(l,k,g),ref:b,slot:a.slot||void 0,"data-focused":h||void 0,"data-orientation":e,"data-focus-visible":i||void 0,"data-disabled":f.isDisabled||void 0},c.default.createElement(v.Provider,{values:[[$,a],[_,f]]},k.children))}let ac=(0,c.forwardRef)(function(a,b){return(0,c.useContext)(_)?c.default.createElement(ad,{props:a,forwardedRef:b}):c.default.createElement(O.Collection,a)});function ad({props:a,forwardedRef:b}){let d=(0,c.useContext)(_),{CollectionRoot:e}=(0,c.useContext)(w.CollectionRendererContext),{orientation:f="horizontal",keyboardActivation:g="automatic"}=(0,v.useSlottedContext)($),h=(0,R.useObjectRef)(b),{tabListProps:i}=function(a,b,d){let{orientation:e="horizontal",keyboardActivation:f="automatic"}=a,{collection:g,selectionManager:h,disabledKeys:i}=b,{direction:j}=(0,G.useLocale)(),k=(0,c.useMemo)(()=>new D(g,j,e,i),[g,i,e,j]),{collectionProps:l}=(0,H.useSelectableCollection)({ref:d,selectionManager:h,keyboardDelegate:k,selectOnFocus:"automatic"===f,disallowEmptySelection:!0,scrollRef:d,linkBehavior:"selection"}),m=(0,E.useId)();B.set(b,m);let n=(0,F.useLabels)({...a,id:m});return{tabListProps:{...(0,A.mergeProps)(l,n),role:"tablist","aria-orientation":e,tabIndex:void 0}}}({...a,orientation:f,keyboardActivation:g},d,h),j=(0,v.useRenderProps)({...a,children:null,defaultClassName:"react-aria-TabList",values:{orientation:f,state:d}}),k=(0,I.filterDOMProps)(a,{global:!0});return delete k.id,c.default.createElement("div",{...(0,A.mergeProps)(k,j,i),ref:h,"data-orientation":f||void 0},c.default.createElement(y.SharedElementTransition,null,c.default.createElement(e,{collection:d.collection,persistedKeys:(0,w.usePersistedKeys)(d.selectionManager.focusedKey)})))}class ae extends P.CollectionNode{}ae.type="item";let af=(0,O.createLeafComponent)(ae,(a,b,d)=>{let e=(0,c.useContext)(_),f=(0,R.useObjectRef)(b),{tabProps:g,isSelected:h,isDisabled:i,isPressed:j}=function(a,b,c){let{key:d,isDisabled:e,shouldSelectOnPressUp:f}=a,{selectionManager:g,selectedKey:h}=b,i=d===h,j=e||b.isDisabled||b.selectionManager.isDisabled(d),{itemProps:k,isPressed:l}=(0,L.useSelectableItem)({selectionManager:g,key:d,ref:c,isDisabled:j,shouldSelectOnPressUp:f,linkBehavior:"selection"}),m=C(b,d,"tab"),n=C(b,d,"tabpanel"),{tabIndex:o}=k,p=b.collection.getItem(d),q=(0,I.filterDOMProps)(null==p?void 0:p.props,{labelable:!0});delete q.id;let r=(0,J.useLinkProps)(null==p?void 0:p.props),{focusableProps:s}=(0,K.useFocusable)({isDisabled:j},c);return{tabProps:(0,A.mergeProps)(q,s,r,k,{id:m,"aria-selected":i,"aria-disabled":j||void 0,"aria-controls":i?n:void 0,tabIndex:j?void 0:o,role:"tab"}),isSelected:i,isDisabled:j,isPressed:l}}({key:d.key,...a},e,f),{focusProps:k,isFocused:l,isFocusVisible:m}=(0,z.useFocusRing)(),{hoverProps:n,isHovered:o}=(0,M.useHover)({isDisabled:i,onHoverStart:a.onHoverStart,onHoverEnd:a.onHoverEnd,onHoverChange:a.onHoverChange}),p=(0,v.useRenderProps)({...a,id:void 0,children:d.rendered,defaultClassName:"react-aria-Tab",values:{isSelected:h,isDisabled:i,isFocused:l,isFocusVisible:m,isPressed:j,isHovered:o}}),q=d.props.href?"a":"div",r=(0,I.filterDOMProps)(a,{global:!0});return delete r.id,delete r.onClick,c.default.createElement(q,{...(0,A.mergeProps)(r,p,g,k,n),ref:f,"data-selected":h||void 0,"data-disabled":i||void 0,"data-focused":l||void 0,"data-focus-visible":m||void 0,"data-pressed":j||void 0,"data-hovered":o||void 0},c.default.createElement(x.SelectionIndicatorContext.Provider,{value:{isSelected:h}},p.children))}),ag=(0,Q.createHideableComponent)(function(a,b){let d=(0,c.useContext)(_),e=(0,R.useObjectRef)(b),f=d.selectedKey===a.id,[g,h]=(0,c.useState)(null!=d.selectedKey?f:null);null==g&&null!=d.selectedKey?h(f):!f&&g&&h(!1);let i=(0,S.useExitAnimation)(e,f);return f||a.shouldForceMount||i?c.default.createElement(ah,{...a,tabPanelRef:e,isInitiallySelected:g||!1,isExiting:i}):null});function ah(a){var b;let d,e,f,g=(0,c.useContext)(_),{id:h,tabPanelRef:i,isInitiallySelected:j,isExiting:k,...l}=a,{tabPanelProps:m}=(d=(0,N.useHasTabbableChild)(i)?void 0:0,e=C(g,null!=(b=a.id)?b:null==g?void 0:g.selectedKey,"tabpanel"),f=(0,F.useLabels)({...a,id:e,"aria-labelledby":C(g,null==g?void 0:g.selectedKey,"tab")}),{tabPanelProps:(0,A.mergeProps)(f,{tabIndex:d,role:"tabpanel","aria-describedby":a["aria-describedby"],"aria-details":a["aria-details"]})}),{focusProps:n,isFocused:o,isFocusVisible:p}=(0,z.useFocusRing)(),q=g.selectedKey===a.id,r=(0,S.useEnterAnimation)(i)&&!j,s=(0,v.useRenderProps)({...a,defaultClassName:"react-aria-TabPanel",values:{isFocused:o,isFocusVisible:p,isInert:(0,T.inertValue)(!q),isEntering:r,isExiting:k,state:g}}),t=(0,I.filterDOMProps)(l,{global:!0});delete t.id;let u=q?(0,A.mergeProps)(t,m,n,s):(0,A.mergeProps)(t,s);return c.default.createElement("div",{...u,ref:i,"data-focused":o||void 0,"data-focus-visible":p||void 0,inert:(0,T.inertValue)(!q||a.inert),"data-inert":q?void 0:"true","data-entering":r||void 0,"data-exiting":k||void 0},c.default.createElement(v.Provider,{values:[[$,null],[_,null]]},c.default.createElement(w.CollectionRendererContext.Provider,{value:w.DefaultCollectionRenderer},s.children)))}var ai=a.i(10782);let aj={sm:{"button-brand":"text-sm font-semibold py-2 px-3","button-gray":"text-sm font-semibold py-2 px-3","button-border":"text-sm font-semibold py-2 px-3","button-minimal":"text-sm font-semibold py-2 px-3",underline:"text-sm font-semibold px-1 pb-2.5 pt-0",line:"text-sm font-semibold pl-2.5 pr-3 py-0.5"},md:{"button-brand":"text-md font-semibold py-2.5 px-3","button-gray":"text-md font-semibold py-2.5 px-3","button-border":"text-md font-semibold py-2.5 px-3","button-minimal":"text-md font-semibold py-2.5 px-3",underline:"text-md font-semibold px-1 pb-2.5 pt-0",line:"text-md font-semibold pr-3.5 pl-3 py-1"}},ak=(0,c.createContext)({size:"sm",type:"button-brand"}),al=a=>{let{label:d,children:e,badge:f,...g}=a,{size:h="sm",type:i="button-brand",fullWidth:j}=(0,c.useContext)(ak);return(0,b.jsx)(af,{...g,className:b=>(0,ai.cx)("z-10 flex h-max cursor-pointer items-center justify-center gap-2 rounded-md whitespace-nowrap text-quaternary transition duration-100 ease-linear","group-orientation-vertical:justify-start",j&&"w-full flex-1",aj[h][i],(({isFocusVisible:a,isSelected:b,isHovered:c})=>({"button-brand":(0,ai.cx)("outline-focus-ring",a&&"outline-2 -outline-offset-2",(b||c)&&"bg-brand-primary_alt text-brand-secondary"),"button-gray":(0,ai.cx)("outline-focus-ring",c&&"bg-primary_hover text-secondary",a&&"outline-2 -outline-offset-2",b&&"bg-active text-secondary"),"button-border":(0,ai.cx)("outline-focus-ring",(b||c)&&"bg-primary_alt text-secondary shadow-sm",a&&"outline-2 -outline-offset-2"),"button-minimal":(0,ai.cx)("rounded-lg outline-focus-ring",c&&"text-secondary",a&&"outline-2 -outline-offset-2",b&&"bg-primary_alt text-secondary shadow-xs ring-1 ring-primary ring-inset"),underline:(0,ai.cx)("rounded-none border-b-2 border-transparent outline-focus-ring",(b||c)&&"border-fg-brand-primary_alt text-brand-secondary",a&&"outline-2 -outline-offset-2"),line:(0,ai.cx)("rounded-none border-l-2 border-transparent outline-focus-ring",(b||c)&&"border-fg-brand-primary_alt text-brand-secondary",a&&"outline-2 -outline-offset-2")}))(b)[i],"function"==typeof a.className?a.className(b):a.className),children:a=>(0,b.jsxs)(c.Fragment,{children:["function"==typeof e?e(a):e||d,f&&(0,b.jsx)(t.Badge,{size:h,type:"pill-color",color:(({isSelected:a,isHovered:b})=>({"button-brand":a||b?"brand":"gray","button-gray":"gray","button-border":"gray","button-minimal":"gray",underline:a||b?"brand":"gray",line:a||b?"brand":"gray"}))(a)[i],className:(0,ai.cx)("hidden transition-inherit-all md:flex","sm"===h&&"-my-px"),children:f})]})})},am=({className:a,...c})=>(0,b.jsx)(aa,{keyboardActivation:"manual",...c,className:b=>(0,ai.cx)("flex w-full flex-col","function"==typeof a?a(b):a)});am.Panel=a=>(0,b.jsx)(ag,{...a,className:b=>(0,ai.cx)("outline-focus-ring focus-visible:outline-2 focus-visible:outline-offset-2","function"==typeof a.className?a.className(b):a.className)}),am.List=({size:a="sm",type:c="button-brand",orientation:d,fullWidth:e,className:f,children:g,...h})=>{let i=(0,v.useSlottedContext)($),j=d??i?.orientation??"horizontal";return(0,b.jsx)(ak.Provider,{value:{size:a,type:c,orientation:j,fullWidth:e},children:(0,b.jsx)(ac,{...h,className:b=>(0,ai.cx)("group flex",(({size:a,fullWidth:b})=>({"button-brand":"gap-1","button-gray":"gap-1","button-border":(0,ai.cx)("gap-1 rounded-[10px] bg-secondary_alt p-1 ring-1 ring-secondary ring-inset","md"===a&&"rounded-xl p-1.5"),"button-minimal":"gap-0.5 rounded-lg bg-secondary_alt ring-1 ring-inset ring-secondary",underline:(0,ai.cx)("gap-3",b&&"w-full gap-4"),line:"gap-2"}))({size:a,fullWidth:e})[c],"vertical"===j&&"w-max flex-col","horizontal"===j&&"underline"===c&&"relative before:absolute before:inset-x-0 before:bottom-0 before:h-px before:bg-border-secondary","function"==typeof f?f(b):f),children:g??(a=>(0,b.jsx)(al,{...a,children:a.children}))})})},am.Item=al,a.i(64304);var an=a.i(55662),ao=a.i(83319),ao=ao,ap=a.i(71883),aq=a.i(20455),ar=a.i(65382),as=a.i(56711);function at(){let[a,v]=(0,c.useState)("active"),[w,x]=(0,c.useState)(null),[y,z]=(0,c.useState)(""),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)([]),[E,F]=(0,c.useState)([]),[G,H]=(0,c.useState)(!1),[I,J]=(0,c.useState)(!1),[K,L]=(0,c.useState)(!1),M=(0,c.useRef)(!1),N=(0,c.useRef)(null),O=C.find(a=>a._id===w);(0,c.useEffect)(()=>{let b=async()=>{H(!0);try{var b;let c,d=(await (c=(b=a)?`?status=${b}`:"",aq.apiClient.get(`/chats${c}`))).map(a=>{let b=a.visitorId;return{...a,customerName:b?.name||"Visitor "+b?._id?.substring(0,4),countryCode:b?.location?.country||"US",visitorInfo:T(b)}});D(d),d.length>0?w&&d.find(a=>a._id===w)||x(d[0]._id):x(null)}catch(a){console.error("Failed to fetch chats:",a)}finally{H(!1)}};b();let c=setInterval(b,1e4);return()=>clearInterval(c)},[a]);let P=(0,c.useRef)(null);(0,c.useEffect)(()=>{if(!w||!O?.visitorId)return;let a=O.visitorId._id;a===P.current||(async()=>{J(!0);try{let b;P.current=a;let c=await (b=a,aq.apiClient.get(`/chats/history/${b}`));F(c)}catch(a){console.error("Failed to fetch history:",a),P.current=null}finally{J(!1)}})()},[w,O?.visitorId]);let Q=(0,c.useRef)(w),R=(0,c.useRef)(null);(0,c.useEffect)(()=>{Q.current=w,R.current=O?.visitorId?O.visitorId._id:null},[w,O]),(0,c.useEffect)(()=>{ar.socketService.connect();let a=new Audio("https://codeskulptor-demos.commondatastorage.googleapis.com/pang/pop.mp3"),b=ar.socketService.on("new-message",b=>{console.log("ChatPage handleNewMessage:",b._id),"visitor"===b.sender&&a.play().catch(a=>console.log("Audio play failed:",a)),D(a=>a.map(a=>{if(a.visitorId?._id===b.visitorId){let c=a._id===Q.current;return{...a,lastMessage:b.text,updatedAt:b.createdAt,unreadCount:c||"agent"===b.sender?a.unreadCount||0:(a.unreadCount||0)+1}}return a})),b.visitorId===R.current&&F(a=>a.some(a=>a._id===b._id)?a:[...a,b])});return()=>{b(),ar.socketService.disconnect()}},[]),(0,c.useEffect)(()=>{N.current?.scrollIntoView({behavior:"smooth"})},[E]);let S=async()=>{let a;if(y.trim()&&O){if(M.current)return void console.log("Message sending already in progress");if(O.visitorId&&"object"==typeof O.visitorId&&"_id"in O.visitorId?a=O.visitorId._id:"string"==typeof O.visitorId&&(a=O.visitorId),console.log("Sending message to visitor:",a,"for chat:",O._id),!a){console.error("Cannot send message: Missing visitor ID for chat",O),alert("Error: Cannot identify visitor for this chat. Please refresh or try another chat.");return}M.current=!0,L(!0);try{let b,c,d=await (b=a,c=y,aq.apiClient.post(`/chats/${b}/message`,{text:c,sender:"agent"}));console.log("Message sent successfully via API"),d&&(F(a=>a.some(a=>a._id===d._id)?a:[...a,d]),D(a=>a.map(a=>a.visitorId&&a.visitorId._id===d.visitorId?{...a,lastMessage:d.text,updatedAt:d.createdAt,unreadCount:0}:a))),z("")}catch(a){console.error("Failed to send message:",a),alert("Failed to send message. Please try again.")}finally{setTimeout(()=>{M.current=!1,L(!1)},100)}}},T=a=>({browserType:"Chrome",browserVersion:"Latest",referralLink:"",ipAddress:a?.ip||"",javaSupport:!1,cookieSupport:!0,characterEncoding:"UTF-8",languageAccepted:"en-US",screenResolution:"1920x1080",colorDepth:24,operatingSystem:"Windows",userAgent:a?.userAgent||"",visitorLocation:{city:a?.location?.city||"Unknown",state:"",country:a?.location?.country||"Unknown",countryCode:"US",latitude:0,longitude:0,locationLink:""}});return(0,b.jsxs)("div",{className:"flex h-[calc(100vh-64px)] w-full bg-white overflow-hidden",children:[(0,b.jsxs)("div",{className:"w-80 flex flex-col border-r border-gray-200 h-full shrink-0",children:[(0,b.jsxs)("div",{className:"p-4 border-b border-gray-200 flex items-center justify-between",children:[(0,b.jsx)("h2",{className:"text-lg font-semibold text-gray-900",children:"My Chats"}),(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:d.FilterLines,onClick:()=>console.log("Filter clicked")})]}),(0,b.jsx)("div",{className:"px-2 pt-2",children:(0,b.jsx)(am,{selectedKey:a,onSelectionChange:a=>v(a),className:"w-full",children:(0,b.jsxs)(am.List,{type:"underline",fullWidth:!0,items:[],children:[(0,b.jsx)(am.Item,{id:"active",children:"Active"}),(0,b.jsx)(am.Item,{id:"missed",children:"Missed"}),(0,b.jsx)(am.Item,{id:"closed",children:"Closed"})]})})}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto",children:G?(0,b.jsx)("div",{className:"p-8 text-center text-gray-500 text-sm",children:"Loading chats..."}):0===C.length?(0,b.jsxs)("div",{className:"p-8 text-center text-gray-500 text-sm",children:["No ",a," chats"]}):C.map(a=>(0,b.jsxs)("div",{onClick:()=>x(a._id),className:(0,ai.cx)("p-4 border-b border-gray-100 cursor-pointer hover:bg-gray-50 transition-colors",w===a._id?"bg-blue-50/50":""),children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.Globe01,{className:"size-3 text-gray-400"}),(0,b.jsx)("span",{className:"font-medium text-sm text-gray-900",children:a.customerName}),(0,b.jsxs)("span",{className:"text-xs text-gray-500",children:["#",a.chatId?.substring(0,6)]})]}),(0,b.jsx)("span",{className:"text-xs text-gray-500",children:a.lastMessageAt?(0,as.format)(new Date(a.lastMessageAt),"HH:mm"):""})]}),(0,b.jsx)("p",{className:"text-sm text-gray-600 truncate",children:a.lastMessage||"No messages"}),a.unreadCount?(0,b.jsx)("div",{className:"mt-2 flex justify-end",children:(0,b.jsx)(t.Badge,{size:"sm",color:"brand",type:"pill-color",children:a.unreadCount})}):null]},a._id))})]}),O?(0,b.jsxs)("div",{className:"flex-1 flex flex-col h-full min-w-0",children:[(0,b.jsxs)("div",{className:"h-16 border-b border-gray-200 flex items-center justify-between px-6 bg-white shrink-0",children:[(0,b.jsxs)("div",{className:"flex flex-col",children:[(0,b.jsx)("div",{className:"flex items-center gap-2",children:(0,b.jsxs)("span",{className:"font-semibold text-gray-900 text-lg",children:["#",O.chatId?.substring(0,8)]})}),(0,b.jsxs)("div",{className:"flex items-center gap-3 text-xs text-gray-500",children:[(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(o.Building02,{className:"size-3"}),(0,b.jsx)("span",{children:"SALES IQ"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(n.User01,{className:"size-3"}),(0,b.jsx)("span",{children:"SALES IQ"})]}),(0,b.jsxs)("div",{className:"flex items-center gap-1",children:[(0,b.jsx)(n.User01,{className:"size-3"}),(0,b.jsx)("span",{children:"SALES IQ"})]})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:p.DotsVertical}),(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:m})]})]}),(0,b.jsxs)("div",{className:"px-6 py-2 border-b border-gray-100 flex items-center gap-2",children:[(0,b.jsx)("span",{className:"text-xs font-medium text-gray-700",children:"Conversation tags"}),(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",className:"rounded-full !p-1 h-6 w-6 rotate-45",children:(0,b.jsx)(h,{className:"size-4"})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto p-6 space-y-6 bg-white",children:I?(0,b.jsx)("div",{className:"text-center text-gray-500 text-sm mt-10",children:"Loading history..."}):0===E.length?(0,b.jsx)("div",{className:"text-center text-gray-500 text-sm mt-10",children:"No messages yet"}):(0,b.jsxs)(b.Fragment,{children:[E.map(a=>{if("system"===a.sender)return(0,b.jsxs)("div",{className:"flex items-center gap-4 py-4",children:[(0,b.jsx)("div",{className:"h-px bg-gray-200 flex-1"}),(0,b.jsx)("span",{className:"text-xs text-gray-400",children:a.text}),(0,b.jsx)("div",{className:"h-px bg-gray-200 flex-1"})]},a._id);let c="agent"===a.sender;return(0,b.jsxs)("div",{className:(0,ai.cx)("flex gap-3 group",c?"flex-row-reverse":""),children:[(0,b.jsx)(r.Avatar,{initials:c?"A":O.customerName.charAt(0),size:"sm",className:(0,ai.cx)("text-xs",c?"bg-blue-100 text-blue-600":"bg-pink-100 text-pink-600")}),(0,b.jsxs)("div",{className:(0,ai.cx)("max-w-[80%]",c?"text-right":""),children:[(0,b.jsx)("div",{className:(0,ai.cx)("flex items-baseline gap-2 mb-1",c?"justify-end":""),children:(0,b.jsx)("span",{className:"text-sm font-medium text-gray-900",children:c?"Agent":O.customerName})}),(0,b.jsx)("div",{className:(0,ai.cx)("rounded-lg px-4 py-2 inline-block text-left",c?"bg-blue-600 text-white rounded-tr-none":"bg-gray-100 text-gray-800 rounded-tl-none"),children:(0,b.jsx)("p",{className:"text-sm",children:a.text})}),(0,b.jsx)("span",{className:"text-xs text-gray-400 ml-2 group-hover:opacity-100 opacity-0 transition-opacity block mt-1",children:(0,as.format)(new Date(a.createdAt),"hh:mm a")})]})]},a._id)}),(0,b.jsx)("div",{ref:N})]})}),(0,b.jsx)("div",{className:"p-4 border-t border-gray-200 bg-white",children:"closed"===O.status?(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.BadgeWithIcon,{color:"success",size:"lg",iconLeading:q,children:"CHAT COMPLETED"}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:["Ended due to chat idle timeout ",(0,b.jsx)("span",{className:"text-blue-600 cursor-pointer",children:"Show details"})]})]}),(0,b.jsx)(s.Button,{color:"primary",className:"bg-blue-600 hover:bg-blue-700 text-white",onClick:()=>console.log("Reply via email clicked"),children:"Reply via Email"})]}):(0,b.jsxs)("div",{className:"relative",children:[(0,b.jsx)(u.Input,{placeholder:"Type a message...",value:y,onChange:a=>z(a),onKeyDown:a=>{"Enter"!==a.key||M.current||(a.preventDefault(),S())},className:"pr-24",isDisabled:K}),(0,b.jsxs)("div",{className:"absolute right-2 top-1/2 -translate-y-1/2 flex items-center gap-1",children:[(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:g.FaceSmile,onClick:()=>console.log("Emoji picker clicked"),disabled:K}),(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:f.Paperclip,onClick:()=>console.log("Attach file clicked"),disabled:K}),(0,b.jsx)(s.Button,{size:"sm",color:"primary",iconLeading:e.Send01,onClick:S,disabled:K})]})]})})]}):(0,b.jsx)("div",{className:"flex-1 flex items-center justify-center bg-gray-50 text-gray-500",children:"Select a chat to start conversation"}),O&&(0,b.jsxs)("div",{className:"w-80 border-l border-gray-200 bg-white flex flex-col h-full overflow-y-auto shrink-0",children:[(0,b.jsxs)("div",{className:"p-6 border-b border-gray-100",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-4",children:[(0,b.jsxs)("div",{className:"flex gap-3",children:[(0,b.jsx)(r.Avatar,{initials:O.customerName.charAt(0),size:"lg",className:"bg-pink-100 text-pink-600 text-lg"}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold text-gray-900",children:O.customerName}),(0,b.jsx)("p",{className:"text-sm text-gray-500",children:O.visitorInfo.visitorLocation.locationLink||"Unknown Location"})]})]}),(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:i,onClick:()=>console.log("Edit customer clicked")})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between group",children:[(0,b.jsx)("div",{className:"flex items-center gap-2 text-sm text-blue-600",children:(0,b.jsx)("span",{className:"truncate max-w-[180px]",children:O.visitorId?.email||"No email"})}),(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",iconLeading:j.Copy01,className:"opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>console.log("Email copied")})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-700",children:[(0,b.jsx)(k.Globe01,{className:"size-4 text-gray-400"}),(0,b.jsx)("span",{children:(0,as.format)(new Date,"dd MMM, yyyy hh:mm a")})]}),(0,b.jsx)("div",{className:"flex items-center gap-2 text-sm text-blue-600 cursor-pointer hover:underline",onClick:()=>B(!0),children:(0,b.jsxs)("span",{className:"flex items-center gap-2",children:[(0,b.jsx)("div",{className:"size-4 rounded-full border border-current flex items-center justify-center text-[10px] font-bold",children:"i"})," More info"]})})]}),(0,b.jsx)("div",{className:"mt-6",children:(0,b.jsxs)("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-900 mb-2",children:[(0,b.jsx)(s.Button,{size:"sm",color:"tertiary",className:"rounded-full !p-0.5 h-5 w-5 rotate-45 bg-gray-200 text-gray-600",children:(0,b.jsx)(h,{className:"size-3"})}),"Contact tags"]})})]}),(0,b.jsxs)("div",{className:"p-6 space-y-4",children:[(0,b.jsx)(au,{label:"Type",value:"New Visitor"}),(0,b.jsx)(au,{label:"Source",value:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Monitor01,{className:"size-4 text-gray-400"}),(0,b.jsx)(ao.default,{className:"size-4 text-gray-400"}),(0,b.jsx)(an.Google,{className:"size-4 text-gray-400"})]})}),(0,b.jsx)(au,{label:"IP address",value:O.visitorInfo.ipAddress}),(0,b.jsx)(au,{label:"Chat initiated page",value:(0,b.jsx)("span",{className:"text-blue-600 truncate block max-w-[150px]",children:O.visitorInfo.referralLink||"Direct"})}),(0,b.jsx)(au,{label:"Current Page",value:(0,b.jsx)("span",{className:"text-blue-600 truncate block max-w-[150px]",children:O.visitorId?.currentPage||"/"})})]})]}),(0,b.jsx)(ap.SlideoutMenu,{isOpen:A,onOpenChange:B,children:(0,b.jsxs)(ap.SlideoutMenu.Content,{children:[(0,b.jsx)(ap.SlideoutMenu.Header,{onClose:()=>B(!1),children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(l.Monitor01,{className:"size-5 text-gray-500"}),(0,b.jsx)("span",{className:"font-semibold text-gray-900 uppercase",children:"VISITOR INFORMATION"})]})}),O&&(0,b.jsxs)("div",{className:"space-y-8 p-6",children:[(0,b.jsxs)("section",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4 uppercase tracking-wider",children:"Browser Information"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8",children:[(0,b.jsx)(av,{label:"Browser",value:O.visitorInfo.browserType}),(0,b.jsx)(av,{label:"Version",value:O.visitorInfo.browserVersion}),(0,b.jsx)(av,{label:"OS",value:O.visitorInfo.operatingSystem}),(0,b.jsx)(av,{label:"Resolution",value:O.visitorInfo.screenResolution}),(0,b.jsx)(av,{label:"User Agent",value:O.visitorInfo.userAgent,className:"col-span-2 break-all"})]})]}),(0,b.jsx)("div",{className:"h-px bg-gray-100"}),(0,b.jsxs)("section",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4 uppercase tracking-wider",children:"Location"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8",children:[(0,b.jsx)(av,{label:"City",value:O.visitorInfo.visitorLocation.city}),(0,b.jsx)(av,{label:"Country",value:O.visitorInfo.visitorLocation.country}),(0,b.jsx)(av,{label:"IP Address",value:O.visitorInfo.ipAddress})]})]}),(0,b.jsx)("div",{className:"h-px bg-gray-100"}),(0,b.jsxs)("section",{children:[(0,b.jsx)("h3",{className:"text-sm font-semibold text-gray-900 mb-4 uppercase tracking-wider",children:"Technical Details"}),(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-y-4 gap-x-8",children:[(0,b.jsx)(av,{label:"Java Enabled",value:O.visitorInfo.javaSupport?"Yes":"No"}),(0,b.jsx)(av,{label:"Cookies Enabled",value:O.visitorInfo.cookieSupport?"Yes":"No"}),(0,b.jsx)(av,{label:"Color Depth",value:`${O.visitorInfo.colorDepth}-bit`}),(0,b.jsx)(av,{label:"Character Encoding",value:O.visitorInfo.characterEncoding})]})]})]})]})})]})}function au({label:a,value:c}){return(0,b.jsxs)("div",{className:"flex justify-between items-center text-sm",children:[(0,b.jsx)("span",{className:"text-gray-500",children:a}),(0,b.jsx)("span",{className:"text-gray-900 font-medium",children:c})]})}function av({label:a,value:c,className:d}){return(0,b.jsxs)("div",{className:d,children:[(0,b.jsx)("dt",{className:"text-xs text-gray-500 mb-1",children:a}),(0,b.jsx)("dd",{className:"text-sm font-medium text-gray-900",children:c||"-"})]})}a.s(["default",()=>at],37314)}];

//# sourceMappingURL=src_app_admin_chats_page_tsx_88c054c7._.js.map